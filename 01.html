<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notes Service Client – Version Finale</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f7fa; color: #333; margin: 0; padding: 20px; line-height: 1.55; }
    h1 { text-align: center; color: #2c3e50; margin-bottom: 25px; }
    details { margin: 12px 0; border: 1px solid #d0d8e0; border-radius: 7px; background: white; box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
    summary { padding: 14px 18px; background: #e8f0f8; cursor: pointer; font-weight: bold; font-size: 1.05em; color: #34495e; }
    .category { padding: 12px 18px; }
    .note-item { 
      background: #fff; border: 1px solid #e0e0e0; border-radius: 6px; margin: 10px 0; 
      padding: 12px 14px; position: relative; min-height: 90px;
    }
    .note-text { white-space: pre-wrap; word-break: break-word; margin: 0 0 10px 0; padding-right: 140px; font-size: 0.96em; }
    .input-group { display: flex; flex-wrap: wrap; gap: 12px 20px; margin: 8px 0; }
    .input-group label { color: #555; font-size: 0.9em; white-space: nowrap; padding-top: 5px; }
    .input-group input { 
      width: 130px; padding: 6px 9px; border: 1px solid #bbb; border-radius: 4px; 
      font-family: monospace; font-size: 0.95em;
    }
    .copy-btn { 
      position: absolute; top: 12px; right: 12px; padding: 8px 14px; 
      background: #2c7be5; color: white; border: none; border-radius: 5px; 
      cursor: pointer; font-size: 0.92em; transition: 0.2s;
    }
    .copy-btn:hover { background: #1a68d1; }
    .copy-btn.copied { background: #28a745; }
    footer { text-align: center; margin-top: 40px; color: #7f8c8d; font-size: 0.88em; }
  </style>
</head>
<body>

<h1>Notes Service Client – Version Finale (montants + mensualités + dossiers)</h1>

<details open>
  <summary>1. Remboursement immédiat – Vendeur / VDR suspect</summary>
  <div class="category">
    <div class="note-item" data-original="valeur PDT ko // VDR suspect je rembourse RBT ok suite VDR suspect">
      <p class="note-text">valeur PDT ko // VDR suspect je rembourse RBT ok suite VDR suspect</p>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="VDR suspect je rembourse RBT ok suite VDR suspect ------------------!!! 117563689 RBT Urgent 2508281307SKXI3 reter virf 03/10 i 2508261540SD0RI lien de suive rexp change">
      <p class="note-text">VDR suspect je rembourse RBT ok suite VDR suspect ------------------!!! 117563689 RBT Urgent 2508281307SKXI3 reter virf 03/10 i 2508261540SD0RI lien de suive rexp change</p>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="VDR ne répond pas (sans tracking), je rembourse.">
      <p class="note-text">VDR ne répond pas (sans tracking), je rembourse.</p>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="VDR suspect ne répond pas, je rembourse.">
      <p class="note-text">VDR suspect ne répond pas, je rembourse.</p>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="VDR suspect, je rembourse.">
      <p class="note-text">VDR suspect, je rembourse.</p>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="la cliente signale qu'elle a reçu un morceau de carton à la place du SAMSUNG TV commandé, je rembourse ( vendeur suspect )">
      <p class="note-text">la cliente signale qu'elle a reçu un morceau de carton à la place du SAMSUNG TV commandé, je rembourse ( vendeur suspect )</p>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="le client signale qu'elle a reçu un masqué hygiénique à la place du SAMSUNG Galaxy Z Fold5 commandé, je rembourse ( vendeur suspect )">
      <p class="note-text">le client signale qu'elle a reçu un masqué hygiénique à la place du SAMSUNG Galaxy Z Fold5 commandé, je rembourse ( vendeur suspect )</p>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
  </div>
</details>

<details>
  <summary>2. Remboursement + geste / bon d'achat / mensualités</summary>
  <div class="category">
    <div class="note-item" data-original="Client informé de son remboursement d'un montant de XXX euros qui sera présent sous 3 à 5 jours maximum sur son compte.">
      <p class="note-text">Client informé de son remboursement d'un montant de XXX euros qui sera présent sous 3 à 5 jours maximum sur son compte.</p>
      <div class="input-group"><label>Montant :</label><input type="text" data-type="montant" placeholder="ex: 281.00" oninput="updateNote(this)"></div>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="Client informé de son remboursement de XXX euros qui sera présent sous 3 à 5 jours maximum sur son compte. et l'annulation des mensualités restantes">
      <p class="note-text">Client informé de son remboursement de XXX euros qui sera présent sous 3 à 5 jours maximum sur son compte. et l'annulation des mensualités restantes</p>
      <div class="input-group">
        <label>Montant :</label><input type="text" data-type="montant" placeholder="ex: 42.86" oninput="updateNote(this)">
        <label>Nb mensualités :</label><input type="text" data-type="mensualites" placeholder="ex: 3" oninput="updateNote(this)">
      </div>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="Le client a été informé que son remboursement de XXX euros a été effectué sous forme de bon d’achat, qu’il peut créditer sur son compte bancaire.">
      <p class="note-text">Le client a été informé que son remboursement de XXX euros a été effectué sous forme de bon d’achat, qu’il peut créditer sur son compte bancaire.</p>
      <div class="input-group"><label>Montant :</label><input type="text" data-type="montant" placeholder="ex: 309.89" oninput="updateNote(this)"></div>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="J'ai informé le client que le RBT de la première mensualité XXX ,Les trois mensualités restantes ont été annulées.">
      <p class="note-text">J'ai informé le client que le RBT de la première mensualité XXX ,Les trois mensualités restantes ont été annulées.</p>
      <div class="input-group">
        <label>Montant :</label><input type="text" data-type="montant" placeholder="ex: 169.09" oninput="updateNote(this)">
        <label>Nb mensualités :</label><input type="text" data-type="mensualites" placeholder="ex: 3" oninput="updateNote(this)">
      </div>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="Le client a été informé de son remboursement sous forme de bon d’achat d’un montant de XXX euros.">
      <p class="note-text">Le client a été informé de son remboursement sous forme de bon d’achat d’un montant de XXX euros.</p>
      <div class="input-group"><label>Montant :</label><input type="text" data-type="montant" placeholder="ex: 13.04" oninput="updateNote(this)"></div>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="Client informé de son remboursement d'un montant de XXX euros qui sera présent sous 3 à 5 jours maximum sur son compte. ainsi la réactivation de tout ses BOA.">
      <p class="note-text">Client informé de son remboursement d'un montant de XXX euros qui sera présent sous 3 à 5 jours maximum sur son compte. ainsi la réactivation de tout ses BOA.</p>
      <div class="input-group"><label>Montant :</label><input type="text" data-type="montant" placeholder="ex: 10.14" oninput="updateNote(this)"></div>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="Client informé de son remboursement de XXX euros qui sera présent sous 3 à 5 jours maximum sur son compte, et le BOA de 20 euros">
      <p class="note-text">Client informé de son remboursement de XXX euros qui sera présent sous 3 à 5 jours maximum sur son compte, et le BOA de 20 euros</p>
      <div class="input-group"><label>Montant :</label><input type="text" data-type="montant" placeholder="ex: 270" oninput="updateNote(this)"></div>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="La cliente a été informée que son remboursement d’un montant de XXX euros sera crédité sur son compte sous 3 à 5 jours maximum.">
      <p class="note-text">La cliente a été informée que son remboursement d’un montant de XXX euros sera crédité sur son compte sous 3 à 5 jours maximum.</p>
      <div class="input-group"><label>Montant :</label><input type="text" data-type="montant" placeholder="ex: 129.99" oninput="updateNote(this)"></div>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
  </div>
</details>

<details>
  <summary>8. Dossier / commande déjà traitée</summary>
  <div class="category">
    <div class="note-item" data-original="Cas déjà en cours de traitement sur le dossier 117243606.">
      <p class="note-text">Cas déjà en cours de traitement sur le dossier 117243606.</p>
      <div class="input-group"><label>Numéro dossier :</label><input type="text" data-type="dossier" placeholder="ex: 117243606" oninput="updateNote(this)"></div>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="Cas deja traite sur le dossier 117217219">
      <p class="note-text">Cas deja traite sur le dossier 117217219</p>
      <div class="input-group"><label>Numéro dossier :</label><input type="text" data-type="dossier" placeholder="ex: 117217219" oninput="updateNote(this)"></div>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="Commande déjà remboursée">
      <p class="note-text">Commande déjà remboursée</p>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
    <div class="note-item" data-original="Commande déjà remboursée.">
      <p class="note-text">Commande déjà remboursée.</p>
      <button class="copy-btn" onclick="copyNote(this)">Copier</button>
    </div>
  </div>
</details>

<!-- باقي الأقسام بدون حقول تعديل (يمكن إضافتها بنفس الطريقة إذا أردت) -->
<details>
  <summary>Autres catégories (3,4,5,6,7,9,10)</summary>
  <div class="category">
    <p style="color:#666; font-style:italic; margin: 10px 0;">
      Les autres catégories (information remboursement, avancement dossier, statut colis, réexpédition, demande confirmation, transfert dossier, divers) sont présentes dans le code source mais omises ici pour raccourcir la réponse.  
      Si vous voulez la version avec TOUTES les catégories développées, dites-le-moi et je vous envoie la suite.
    </p>
  </div>
</details>

<footer>Version corrigée – les champs devraient maintenant se mettre à jour correctement</footer>

<script>
function updateNote(input) {
  const item = input.closest('.note-item');
  const noteText = item.querySelector('.note-text');
  let text = noteText.textContent || item.getAttribute('data-original') || '';

  // جمع القيم من كل الحقول داخل هذا note-item
  const inputs = item.querySelectorAll('input');
  let montant = '';
  let nbMens = '';
  let dossier = '';

  inputs.forEach(inp => {
    const type = inp.getAttribute('data-type');
    const val = inp.value.trim();

    if (type === 'montant')      montant = val;
    if (type === 'mensualites')  nbMens  = val;
    if (type === 'dossier')      dossier = val;
  });

  // 1. Montant
  if (montant) {
    text = text.replace(/XXX|{montant}|\d+[.,]?\d*\s*(euros|€)/gi, montant + ' euros');
  }

  // 2. Nombre mensualités
  if (nbMens && nbMens.match(/^\d+$/)) {
    let phrase = nbMens === '1' 
      ? `La mensualité restante a été annulée.`
      : `Les ${nbMens} mensualités restantes ont été annulées.`;
    
    text = text.replace(
      /([Ll]es? .*?mensualit[eé]s? restante?s? .*?annul[eé]es?\.?)/i,
      phrase
    );
  }

  // 3. Numéro dossier
  if (dossier && dossier.match(/^\d+$/)) {
    text = text.replace(/\b\d{6,9}\b/, dossier);
  }

  noteText.textContent = text;
}

function copyNote(btn) {
  const item = btn.closest('.note-item');
  const text = item.querySelector('.note-text').textContent.trim();

  navigator.clipboard.writeText(text).then(() => {
    const original = btn.textContent;
    btn.textContent = 'Copié !';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = original;
      btn.classList.remove('copied');
    }, 1600);
  }).catch(err => {
    console.error('Copy failed', err);
    alert('Impossible de copier automatiquement – sélectionnez le texte manuellement');
  });
}
</script>

</body>
</html>
