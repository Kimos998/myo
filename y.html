<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Remboursement</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0066cc;
            --success: #28a745;
            --light: #f8f9fa;
            --border: #dee2e6;
            --text: #212529;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--light);
            color: var(--text);
            padding: 12px;
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        h3 {
            background: var(--primary);
            color: white;
            padding: 14px 18px;
            margin: 0;
            font-size: 1.25rem;
        }

        .form {
            padding: 18px;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
        }

        .form-row label {
            font-weight: 600;
            min-width: 150px;
            flex: 0 0 150px;
        }

        .form-row input[type="number"],
        .form-row select {
            flex: 1;
            min-width: 140px;
            padding: 9px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        #note-area {
            width: 100%;
            min-height: 160px;
            max-height: 500px;
            padding: 14px;
            font-size: 1rem;
            line-height: 1.55;
            background: #f8fff8;
            border: 1px solid #b8e0c2;
            border-radius: 8px;
            resize: vertical;
            font-family: system-ui, monospace;
            white-space: pre-wrap;
        }

        .copy-container {
            padding: 0 18px 18px;
            text-align: right;
        }

        .copy-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .copy-btn:hover { background: #0055b3; }
        .copy-btn.copied {
            background: var(--success);
            transform: scale(1.04);
        }

        @media (max-width: 600px) {
            .form-row {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            .form-row label {
                min-width: auto;
            }
            h3 { font-size: 1.1rem; padding: 12px 16px; }
            .form { padding: 14px; }
        }
    </style>
</head>
<body>

<div class="container">
    <h3>Note de Remboursement</h3>

    <div class="form">
        <div class="form-row">
            <label>Genre :</label>
            <select id="genre">
                <option value="inconnu">Inconnu / Neutre</option>
                <option value="homme">Homme (Client)</option>
                <option value="femme">Femme (Cliente)</option>
            </select>
        </div>

        <div class="form-row">
            <label>Montant remboursé :</label>
            <input type="number" step="0.01" id="montant" value="212">
            <span style="white-space:nowrap;"> €</span>
        </div>

        <div class="form-row">
            <label>Mensualités annulées :</label>
            <select id="mensualites">
                <option value="0">Aucune (paiement unique)</option>
                <option value="1">1 mensualité restante</option>
                <option value="2">2 mensualités restantes</option>
                <option value="3">3 mensualités restantes</option>
            </select>
        </div>

        <div class="form-row checkbox-group">
            <input type="checkbox" id="boa">
            <label for="boa">Réactiver les BOA</label>
        </div>

        <div class="form-row checkbox-group">
            <input type="checkbox" id="geste">
            <label for="geste">Geste commercial</label>
            <input type="number" step="0.01" id="geste_montant" placeholder="ex: 20" style="width:110px; display:none;">
            <span id="geste_unit" style="display:none;">€</span>
        </div>

        <textarea id="note-area" readonly placeholder="La note apparaîtra ici..."></textarea>
    </div>

    <div class="copy-container">
        <button class="copy-btn" id="copyButton">Copier la note</button>
    </div>
</div>

<script>
    const gesteChk = document.getElementById('geste');
    const gesteAmt = document.getElementById('geste_montant');
    const gesteUnit = document.getElementById('geste_unit');
    const copyBtn = document.getElementById('copyButton');

    gesteChk.addEventListener('change', () => {
        const show = gesteChk.checked;
        gesteAmt.style.display = show ? 'inline-block' : 'none';
        gesteUnit.style.display = show ? 'inline' : 'none';
        if (show && !gesteAmt.value) gesteAmt.value = '20';
        updateNote();
    });

    function formatMontant(val) {
        const num = Number(val);
        if (isNaN(num) || num === 0) return '0';
        if (Number.isInteger(num)) return num.toString();
        return num.toFixed(2).replace('.', ',');
    }

    function updateNote() {
        const genre = document.getElementById('genre').value;
        const rawMontant = parseFloat(document.getElementById('montant').value) || 0;
        const montant = formatMontant(rawMontant);
        const reste = parseInt(document.getElementById('mensualites').value) || 0;
        const boa = document.getElementById('boa').checked;
        const gesteOn = gesteChk.checked;
        const gesteRaw = gesteOn ? parseFloat(gesteAmt.value) || 0 : 0;
        const geste = formatMontant(gesteRaw);

        const delai = "3 à 5";
        const sujet = genre === 'femme' ? 'Cliente informée' : 'Client informé';
        const prep = genre === 'femme' ? 'à la cliente' : 'au client';
        const part = genre === 'femme' ? 'occasionnée' : 'occasionné';

        let text = `${sujet} de son remboursement d'un montant de ${montant} euros qui sera visible sur son compte ${delai},`;

        if (reste === 1) {
            text += ` la mensualité restante a été annulée,`;
        } else if (reste >= 2) {
            text += ` les ${reste} mensualités restantes ont été annulées,`;
        }

        if (boa) {
            text += ` Les bons d'achat ont également été réactivés`;
        }

        if (gesteOn && gesteRaw > 0) {
            let phrase = `un geste commercial de ${geste} euros a été accordé ${prep} suite à la gêne ${part}.`;
            if (boa || reste >= 1) {
                text += ` et ${phrase}`;
            } else {
                text += ` ${phrase}`;
            }
        } else if (boa || reste >= 1) {
            text = text.replace(/,$/, '.');
        } else {
            text = text.replace(/,$/, '.');
        }

        document.getElementById('note-area').value = text.trim();
    }

    function copyToClipboard() {
        const text = document.getElementById('note-area').value.trim();
        if (!text) {
            copyBtn.textContent = 'Rien à copier';
            setTimeout(() => copyBtn.textContent = 'Copier la note', 1800);
            return;
        }

        navigator.clipboard.writeText(text)
            .then(() => {
                const original = copyBtn.textContent;
                copyBtn.textContent = 'Copié !';
                copyBtn.classList.add('copied');
                setTimeout(() => {
                    copyBtn.textContent = original;
                    copyBtn.classList.remove('copied');
                }, 1600);
            })
            .catch(err => {
                console.error('Erreur de copie :', err);
                copyBtn.textContent = 'Erreur – réessayez';
                setTimeout(() => copyBtn.textContent = 'Copier la note', 2500);
            });
    }

    // Événements
    document.querySelectorAll('#genre, #montant, #mensualites, #boa, #geste, #geste_montant')
        .forEach(el => el.addEventListener('input', updateNote));
    document.querySelectorAll('#genre, #mensualites, #boa').forEach(el => el.addEventListener('change', updateNote));

    copyBtn.addEventListener('click', copyToClipboard);

    // Initialisation
    updateNote();
</script>
</body>
</html>
